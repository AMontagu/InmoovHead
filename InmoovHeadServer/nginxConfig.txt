map $http_upgrade $connection_upgrade {
	default upgrade;
	'' close;
}

server {
	listen 80 default_server;
	listen [::]:80 default_server;

	root /home/pi/in/hease/web-app/dist;
	index index.html;

	location / {
		try_files /index.html /index.html;
	}
}

server {
	listen 443 ssl;

	root /home/hease/release/hease/web-app/dist;
	index index.html;

	#server_name hease.com www.hease.com;

	ssl_certificate /etc/nginx/ssl/server.crt;
	ssl_certificate_key /etc/nginx/ssl/server.key;

	charset     utf-8;

	add_header Strict-Transport-Security "max-age=31536000";

	location /peerjs {
        proxy_pass  http://127.0.0.1:9000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
    }

	location /ws/ {
		proxy_pass  http://127.0.0.1:8000/ws/;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection $connection_upgrade;
	}

	location / {
		try_files $uri $uri/ /index.html;
	}
}